{% load staticfiles %}

<!DOCTYPE html>
<html>

<head>
	<link rel="stylesheet" type="text/css" href="{% static 'irrigation/css/bootstrap.css' %}">
	
</head>

<body>

	<div class="row">
		<div class="col-lg-12">
			<div class="navbar navbar-default">
				<div class="container-fluid">
					<div class="container-fluid">
						<div class="navbar-header">
								<img alt="Brand" src="http://www.tamandua.com.br/imagens/pombo.jpg" width="100" height="100"/>
						</div>
						<button type="button" class="btn btn-danger pull-right" style="margin-top:20px">Desativar Sistema</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-6">
			<div class="panel panel-default">
				<div class="panel-body">
					Ultima Leitura: <span class="badge">{{ lastmoisture.moisture}}</span>
				</div>
			</div>
			
		</div>

		<div class="col-lg-6">
			<div class="panel panel-default">
				<div class="panel-body">
					Status Sistema: <span class="badge">Ligado</span>
				</div>
			</div>
			
		</div>
		
	</div>

	<div class="row">
			<div class="col-lg-12">
			<table class="table" id="moistureTable">
				<thead>
				<tr> <th>Estado Solo ( % Umidade)</th><th> Data Leitura</th> <th>Id Arduino</th></tr>
				</thead>
				<tbody>
				{% if moistureList %}
					{%for moisture in moistureList%}
						<tr>
							<td>{{ moisture.moisture }}</td>
							<td>{{ moisture.date }}</td>
							<td>{{ moisture.arduinoID }}</td>
						</tr>
					{% endfor %}
				{%endif%}
				</tbody>
			</table>
		</div>
	</div>

</body>
</html>

<script src="{% static 'irrigation/js/jquery.js' %}"></script>
<script src="{% static 'irrigation/js/bootstrap.js' %}"></script>
<script type="text/javascript">
	var json;
	
	var lastID={{moistureList.0.id}}
		$(document).ready(function(){
			getMoisture();
				//setInterval(getMoisture,5000);
			
		});
		
		function getMoisture(){
			
					$.ajax({
							type:'POST',
							url:'getMoisture/',
							data:{csrfmiddlewaretoken:'{{csrf_token}}',lastID:1}
							
					}).done(function(data){
							if(data!=""){
									 json=data;
									 $.each(json,function(idx,obj){
										 $('#moistureTable tbody').prepend("<tr><td>"+obj.fields.moisture+"</td><td>"+obj.fields.date+"</td><td>"+obj.fields.arduinoID+"</td></tr>");
										
										 });
									
							}
					});
	}
</script>
